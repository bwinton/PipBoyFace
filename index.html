<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>PipBoyFace Settings</title>
    <link rel="stylesheet" href="bower_components/pebble-slate/dist/css/slate.css"/>
    <style media="screen">
    .item-styled-toggle-wrapper,
    .item-styled-toggle {
      transition-duration: 0.1s;
    }
    </style>
    <!-- <link rel="stylesheet" href="styles.css" /> -->
    <!-- <link rel="shortcut icon" href="/favicon.ico" /> -->
    <script src="bower_components/pebble-slate/dist/js/slate.js" charset="utf-8"></script>
  </head>
  <body>
    <div class="item-container">
      <div class="item-container-header">PipBoyFace Settings</div>
      <div class="item-container-content">
        <div class="item">These are the settings for the PipBoyFace Pebble watchface.</div>
      </div>
    </div>
    <div class="item-container">
      <div class="item-container-header">Display</div>
      <div class="item-container-content">
        <label class="item">
          Analog face
          <input type="checkbox" class="item-toggle" id="face_mode" checked>
        </label>
        <label class="item">
          Shake to show gifs
          <input type="checkbox" class="item-toggle" id="show_gifs" checked>
        </label>
      </div>
    </div>
    <div class="item-container">
      <div class="button-container">
        <input type="button" class="item-button" id="save_button" value="SAVE">
      </div>
    </div>
  </body>

  <script type="text/javascript">
    // Get query variables
    function getQueryParam(variable, defaultValue) {
      // Find all URL parameters
      var query = location.search.substring(1);
      var vars = query.split('&');
      for (var i = 0; i < vars.length; i++) {
        var pair = vars[i].split('=');

        // If the query variable parameter is found, decode it to use and return it for use
        if (pair[0] === variable) {
          return decodeURIComponent(pair[1]);
        }
      }
      return defaultValue || false;
    }

    function saveOptions() {
      var faceMode = document.getElementById("face_mode");
      var showGifs = document.getElementById("show_gifs");

      var options = {
        "faceMode": faceMode.checked ? "on" : "off",
        "showGifs": showGifs.checked ? "on" : "off"
      }

      localStorage.faceMode = options.faceMode;
      localStorage.showGifs = options.showGifs;

      return options;
    };

    var submitButton = document.getElementById("save_button");
    submitButton.addEventListener("click",
      function() {
        console.log("Submit");

        var options = saveOptions();
        // Set the return URL depending on the runtime environment
        var return_to = getQueryParam('return_to', 'pebblejs://close#');
        var location = return_to + encodeURIComponent(JSON.stringify(options));

        document.location = location;
      }, false);

    function loadOptions() {
      var options = {};
      if (localStorage.faceMode) {
        options.faceMode = localStorage.faceMode;
        options.showGifs = localStorage.showGifs;
      }
      options = getQueryParam("options", JSON.stringify(options));
      options = JSON.parse(options);
      var faceMode = document.getElementById("face_mode");
      var showGifs = document.getElementById("show_gifs");

      faceMode.checked = (options.faceMode === "on");
      showGifs.checked = (options.showGifs === "on");

      return;
    };
    loadOptions();

  </script>
</html>
